---
import { Icon } from 'astro-icon/components';

interface Testimonial {
  id: number;
  name: string;
  role: string;
  content: string;
  rating: number;
  avatar: string;
}

const testimonials: Testimonial[] = [
  {
    id: 1,
    name: 'Marcus Thompson',
    role: 'Executive',
    content: "The attention to detail is unmatched. Every visit feels like a bespoke experience tailored just for me. The hot towel shave is transformative.",
    rating: 5,
    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&q=80'
  },
  {
    id: 2,
    name: 'David Chen',
    role: 'Entrepreneur',
    content: "Finally, a place that understands premium grooming. The ambiance, the service, the results - everything exceeds expectations.",
    rating: 5,
    avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&q=80'
  },
  {
    id: 3,
    name: 'James Wilson',
    role: 'Attorney',
    content: "The massage therapy here is world-class. After a stressful week, there's nothing better. They always deliver exactly what I need.",
    rating: 5,
    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&q=80'
  },
  {
    id: 4,
    name: 'Michael Roberts',
    role: 'Creative Director',
    content: "Got my first tattoo here and couldn't be happier. The consultation was thorough, the execution flawless. A true artistic collaboration.",
    rating: 5,
    avatar: 'https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=150&q=80'
  },
];

// Duplicate for seamless marquee
const allTestimonials = [...testimonials, ...testimonials];
---

<section class="testimonials-section" id="testimonials">
  <!-- Background -->
  <div class="testimonials-bg">
    <div class="bg-gradient"></div>
    <div class="quote-decoration">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h4v10h-10z"/>
      </svg>
    </div>
  </div>

  <div class="container">
    <!-- Header -->
    <header class="section-header">
      <div class="header-label" data-animate="fade-in">
        <span class="label-line"></span>
        <span class="label-text">Testimonials</span>
        <span class="label-line"></span>
      </div>
      
      <h2 class="section-title" data-animate="fade-in-up">
        What Our
        <span class="title-accent">Clients</span>
        Say
      </h2>
      
      <p class="section-subtitle" data-animate="fade-in-up">
        Join thousands of satisfied clients who trust us with their grooming needs
      </p>
    </header>
  </div>

  <!-- Testimonials Marquee -->
  <div class="testimonials-marquee">
    <div class="marquee-track">
      {allTestimonials.map((testimonial, index) => (
        <article class="testimonial-card glass" style={`--index: ${index % testimonials.length}`}>
          <!-- Rating -->
          <div class="card-rating" aria-label={`Rating: ${testimonial.rating} out of 5 stars`}>
            {[...Array(5)].map((_, i) => (
              <svg 
                class={`star ${i < testimonial.rating ? 'active' : ''}`}
                viewBox="0 0 20 20" 
                fill="currentColor"
              >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
            ))}
          </div>
          
          <!-- Quote -->
          <blockquote class="card-quote">
            <p>"{testimonial.content}"</p>
          </blockquote>
          
          <!-- Author -->
          <footer class="card-author">
            <img 
              src={testimonial.avatar}
              alt={testimonial.name}
              class="author-avatar"
              loading="lazy"
            />
            <div class="author-info">
              <cite class="author-name">{testimonial.name}</cite>
              <span class="author-role">{testimonial.role}</span>
            </div>
          </footer>
          
          <!-- Quote Icon -->
          <div class="card-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h4v10h-10z"/>
            </svg>
          </div>
        </article>
      ))}
    </div>
  </div>

  <div class="container">
    <!-- Trust Badges -->
    <div class="trust-section" data-animate="fade-in-up">
      <div class="trust-badges">
        <div class="trust-badge">
          <Icon name="lucide:star" size={24} fill="currentColor" stroke="none" />
          <span>5-Star Rated</span>
        </div>
        <div class="badge-divider"></div>
        <div class="trust-badge">
          <Icon name="lucide:badge-check" size={24} />
          <span>Certified Experts</span>
        </div>
        <div class="badge-divider"></div>
        <div class="trust-badge">
          <Icon name="lucide:shield-check" size={24} />
          <span>Satisfaction Guaranteed</span>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .testimonials-section {
    position: relative;
    padding: 8rem 0;
    background: var(--color-snow);
    overflow: hidden;
  }

  /* Background */
  .testimonials-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .bg-gradient {
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(ellipse at 0% 50%, rgba(225, 29, 72, 0.05) 0%, transparent 50%),
      radial-gradient(ellipse at 100% 50%, rgba(225, 29, 72, 0.05) 0%, transparent 50%);
  }

  .quote-decoration {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: 400px;
    opacity: 0.02;
  }

  .quote-decoration svg {
    width: 100%;
    height: 100%;
    color: var(--color-red);
  }

  /* Header */
  .section-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .header-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    opacity: 0;
    animation: fade-in 0.8s var(--ease-out-expo) forwards;
  }

  .label-line {
    width: 40px;
    height: 2px;
    background: var(--color-red);
  }

  .label-text {
    font-size: 0.6875rem;
    font-weight: 700;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--color-red);
  }

  .section-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -0.03em;
    color: var(--color-black);
    margin-bottom: 1rem;
    opacity: 0;
    animation: fade-in-up 0.8s var(--ease-out-expo) 0.1s forwards;
  }

  .title-accent {
    color: var(--color-red);
  }

  .section-subtitle {
    font-size: 1.125rem;
    color: var(--color-gray);
    max-width: 500px;
    margin: 0 auto;
    opacity: 0;
    animation: fade-in-up 0.8s var(--ease-out-expo) 0.2s forwards;
  }

  /* Marquee */
  .testimonials-marquee {
    overflow: hidden;
    padding: 2rem 0;
    mask-image: linear-gradient(90deg, transparent, black 10%, black 90%, transparent);
    -webkit-mask-image: linear-gradient(90deg, transparent, black 10%, black 90%, transparent);
  }

  .marquee-track {
    display: flex;
    gap: 1.5rem;
    animation: marquee 40s linear infinite;
    width: fit-content;
  }

  .testimonials-marquee:hover .marquee-track {
    animation-play-state: paused;
  }

  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* Testimonial Card */
  .testimonial-card {
    position: relative;
    flex-shrink: 0;
    width: 380px;
    padding: 2rem;
    border-radius: var(--radius-xl);
    transition: all 0.4s var(--ease-out-expo);
  }

  .testimonial-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.1);
  }

  .card-rating {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 1.25rem;
  }

  .star {
    width: 18px;
    height: 18px;
    color: var(--color-mist);
    transition: color 0.3s var(--ease-out-expo);
  }

  .star.active {
    color: var(--color-red);
  }

  .card-quote {
    margin-bottom: 1.5rem;
  }

  .card-quote p {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-charcoal);
    font-style: italic;
  }

  .card-author {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .author-avatar {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--color-white);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .author-info {
    display: flex;
    flex-direction: column;
  }

  .author-name {
    font-size: 1rem;
    font-weight: 700;
    font-style: normal;
    color: var(--color-black);
  }

  .author-role {
    font-size: 0.8125rem;
    color: var(--color-gray);
  }

  .card-icon {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 32px;
    height: 32px;
    opacity: 0.08;
    transition: opacity 0.3s var(--ease-out-expo);
  }

  .card-icon svg {
    width: 100%;
    height: 100%;
    color: var(--color-red);
  }

  .testimonial-card:hover .card-icon {
    opacity: 0.15;
  }

  /* Trust Section */
  .trust-section {
    margin-top: 4rem;
    opacity: 0;
    animation: fade-in-up 0.8s var(--ease-out-expo) 0.4s forwards;
  }

  .trust-badges {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .trust-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    background: var(--color-white);
    border-radius: var(--radius-full);
    border: 1px solid var(--color-mist);
    transition: all 0.3s var(--ease-out-expo);
  }

  .trust-badge:hover {
    border-color: var(--color-red);
    transform: translateY(-2px);
  }

  .trust-badge svg {
    width: 24px;
    height: 24px;
    color: var(--color-red);
  }

  .trust-badge span {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-black);
  }

  .badge-divider {
    width: 1px;
    height: 24px;
    background: var(--color-mist);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .testimonial-card {
      width: 340px;
    }
  }

  @media (max-width: 640px) {
    .testimonials-section {
      padding: 5rem 0;
    }

    .testimonial-card {
      width: 300px;
      padding: 1.5rem;
    }

    .card-quote p {
      font-size: 0.9375rem;
    }

    .trust-badges {
      flex-direction: column;
      gap: 1rem;
    }

    .badge-divider {
      display: none;
    }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
